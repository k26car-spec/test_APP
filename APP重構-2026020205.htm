<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YY趣動 - 旗艦完整專業版</title>
    <!-- 核心開發庫 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- 使用穩定版 Babel 避免 targets.esmodules 錯誤 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.24.4/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet Map 運動地圖庫 -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Oswald:wght@500;700&display=swap');
        
        :root {
            --yy-orange: #f97316;
            --yy-indigo: #4f46e5;
            --yy-navy: #1a1c4b;
            --yy-dark: #0f172a;
            --yy-red: #d9433e;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100dvh;
        }

        .app-container {
            width: 100%;
            height: 100dvh;
            background-color: #f8fafc;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 640px) {
            .app-container {
                width: 375px;
                height: 812px;
                border: 8px solid #1e293b;
                border-radius: 3rem;
                box-shadow: 0 40px 100px rgba(0,0,0,0.1);
            }
            .app-notch {
                position: absolute;
                top: 0;
                left: 50%;
                transform: translateX(-50%);
                width: 120px;
                height: 24px;
                background: #1e293b;
                border-bottom-left-radius: 1rem;
                border-bottom-right-radius: 1rem;
                z-index: 100;
            }
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .sport-nums { font-family: 'Oswald', sans-serif; }

        .leaflet-container { border-radius: 1rem !important; }

        @keyframes slide-up { from { transform: translateY(15px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slide-up 0.3s ease-out forwards; }

        @keyframes slide-right { from { transform: translateX(-100%); } to { transform: translateX(0); } }
        .animate-slide-right { animation: slide-right 0.3s ease-out forwards; }

        @keyframes modal-fade { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        .animate-modal { animation: modal-fade 0.2s ease-out forwards; }
        
        .marquee-container { overflow: hidden; white-space: nowrap; width: 100%; }
        .marquee-content {
            display: inline-block;
            animation: marquee 25s linear infinite;
        }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .protruding-btn-wrapper {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: 38px;
            z-index: 60;
        }
        .protruding-btn {
            width: 52px;
            height: 52px;
            border-radius: 18px;
            background-color: var(--yy-dark);
            border: 4px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 6px 15px rgba(0,0,0,0.12);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .protruding-btn.active {
            background-color: var(--yy-orange);
            box-shadow: 0 8px 20px rgba(249, 115, 22, 0.3);
        }
        .protruding-label {
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            font-weight: 900;
            color: #475569;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, addDoc, onSnapshot, query, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const { useState, useEffect, useRef, useMemo } = React;

        // Firebase 初始化
        let app, db, auth;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'yy-sports-flagship';
        let isDemoMode = false;

        try {
            if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                const firebaseConfig = JSON.parse(__firebase_config);
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
            } else {
                isDemoMode = true;
            }
        } catch (e) {
            console.error("Firebase init error:", e);
            isDemoMode = true;
        }

        // --- 圖標組件 ---
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                "menu": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="18" x2="21" y2="18" /></svg>, 
                "grid": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>,
                "x": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6L6 18M6 6l12 12"/></svg>,
                "home": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
                "activity": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
                "pulse": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>, 
                "task": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
                "user": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
                "plus": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
                "bell": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>,
                "chevron-right": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m9 18 6-6-6-6"/></svg>,
                "qr": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>,
                "ticket": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/></svg>,
                "store": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="11" r="5"/><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/></svg>, 
                "share": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>,
                "trash": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/></svg>,
                "map-pin": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
                "dumbbell": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m6.5 6.5 11 11"/><path d="m18 22 4-4"/></svg>,
                "briefcase": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>,
                "navigation": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>,
                "zap": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
                "compass": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>,
                "basketball": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20"/><path d="M2 12a14.5 14.5 0 0 0 20 0"/></svg>,
                "badminton": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 12l-5-5m5 5l5-5m-5 5v7"/></svg>,
                "baseball": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M5.5 5.5a14.5 14.5 0 0 1 13 13"/></svg>,
                "scan": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/></svg>,
                "file-text": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
                "shield": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
                "info": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>,
                "tag": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>,
                "settings": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
                "users": <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            };
            return icons[name] || null;
        };

        // --- 地圖組件 ---
        const MapThumbnail = ({ currentPos }) => {
            const mapContainer = useRef(null);
            const mapInstance = useRef(null);

            useEffect(() => {
                if (!mapInstance.current && mapContainer.current && window.L) {
                    mapInstance.current = L.map(mapContainer.current, { zoomControl: false, attributionControl: false }).setView(currentPos || [25.033, 121.565], 16);
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(mapInstance.current);
                    L.circleMarker(currentPos || [25.033, 121.565], { radius: 8, fillColor: '#f97316', color: '#fff', weight: 3, fillOpacity: 1 }).addTo(mapInstance.current);
                }
                return () => { if (mapInstance.current) { mapInstance.current.remove(); mapInstance.current = null; } };
            }, []);

            return <div ref={mapContainer} className="w-full h-full bg-slate-100 rounded-[2rem]"></div>;
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [currentView, setCurrentView] = useState('home');
            const [activeTab, setActiveTab] = useState('home');
            const [selectedDate, setSelectedDate] = useState(25); // Set to 25 based on the image
            const [funSportsTab, setFunSportsTab] = useState('exercise');
            const [registrationTab, setRegistrationTab] = useState('sports'); 
            const [exerciseMode, setExerciseMode] = useState('戶外跑步');
            const [teamStep, setTeamStep] = useState('activity');
            const [selectedSport, setSelectedSport] = useState(null);
            const [showMenu, setShowMenu] = useState(false);
            const [showShareModal, setShowShareModal] = useState(false);
            const [logs, setLogs] = useState([]);
            const [activeShareData, setActiveShareData] = useState(null);
            const [taskPeriod, setTaskPeriod] = useState('當日');

            const userAvatar = useMemo(() => `https://api.dicebear.com/7.x/bottts-neutral/svg?seed=${user?.uid || 'Felix'}`, [user]);

            // --- Firebase Auth ---
            useEffect(() => {
                const initAuth = async () => {
                    try {
                        if (!isDemoMode && typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else if (!isDemoMode) {
                            await signInAnonymously(auth);
                        } else {
                            setUser({ uid: 'demo-user' }); // Demo mode user
                        }
                    } catch (e) { 
                        console.error("Auth failed, switching to demo:", e);
                        setUser({ uid: 'demo-user' });
                    }
                };
                initAuth();
                if (!isDemoMode && auth) {
                    const unsubscribe = onAuthStateChanged(auth, setUser);
                    return () => unsubscribe();
                }
            }, []);

            // --- Firestore Data (Real or Mock) ---
            useEffect(() => {
                if (!user || isDemoMode) return;
                const logsRef = collection(db, 'artifacts', appId, 'users', user.uid, 'logs');
                const unsubscribe = onSnapshot(logsRef, (snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    data.sort((a, b) => b.createdAt - a.createdAt);
                    setLogs(data);
                });
                return () => unsubscribe();
            }, [user]);

            // --- 追蹤模擬 ---
            const [isRecording, setIsRecording] = useState(false);
            const [trackDist, setTrackDist] = useState(0);
            const [trackTime, setTrackTime] = useState(0);
            const [currentLatLng, setCurrentLatLng] = useState([25.033, 121.565]);

            useEffect(() => {
                let timer;
                if (isRecording) {
                    timer = setInterval(() => {
                        setTrackTime(t => t + 1);
                        setTrackDist(d => d + 0.003);
                    }, 1000);
                }
                return () => clearInterval(timer);
            }, [isRecording]);

            const startTracking = () => { setIsRecording(true); setTrackDist(0); setTrackTime(0); setCurrentView('run_tracking'); };
            const stopTracking = async () => {
                setIsRecording(false);
                if (user && trackDist > 0.01 && !isDemoMode) {
                    await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'logs'), {
                        type: exerciseMode, distance: trackDist.toFixed(2), duration: trackTime, createdAt: Date.now(), date: new Date().getDate()
                    });
                }
                setCurrentView('log');
            };

            const formatDuration = (sec) => {
                const m = Math.floor(sec / 60); const s = sec % 60;
                return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            };

            const renderMain = () => {
                const containerClass = "flex flex-col min-h-full px-5 pb-24 space-y-4 animate-slide-up overflow-y-auto no-scrollbar pt-2";
                
                switch (currentView) {
                    case 'home':
                        return (
                            <div className={containerClass}>
                                <header className="flex justify-between items-center mb-1">
                                    <div className="flex items-center gap-3">
                                        <button onClick={() => setShowMenu(true)}><Icon name="menu" size={24} className="text-slate-800" /></button>
                                        <div className="font-black italic text-2xl text-[#d9433e]">YY</div>
                                    </div>
                                    <div className="flex gap-4 items-center text-slate-700">
                                        <Icon name="grid" size={22}/>
                                        <div className="relative"><Icon name="ticket" size={22}/><span className="absolute -top-1.5 -right-1.5 bg-red-500 text-white text-[7px] w-3.5 h-3.5 rounded-full flex items-center justify-center border border-white font-black">8</span></div>
                                        <div className="relative"><Icon name="bell" size={22}/><span className="absolute -top-1.5 -right-1.5 bg-red-500 text-white text-[7px] w-3.5 h-3.5 rounded-full flex items-center justify-center border border-white font-black">16</span></div>
                                        <Icon name="scan" size={22} />
                                    </div>
                                </header>

                                <div className="relative w-full rounded-2xl overflow-hidden bg-[#fdf3f2] p-6 min-h-[160px] flex flex-col justify-center shadow-sm">
                                    <p className="text-slate-800 font-black text-2xl tracking-tight uppercase italic">除舊佈新</p>
                                    <p className="text-red-500 font-black text-4xl italic tracking-tighter leading-none uppercase">迎福馬</p>
                                    <div className="pt-4 flex gap-2">
                                        <div className="bg-white/80 px-3 py-1 rounded-lg shadow-sm"><p className="text-[8px] font-bold text-slate-400 uppercase mb-0.5">滿 $2000 折</p><p className="text-sm font-black text-red-500 sport-nums">$200</p></div>
                                        <div className="bg-white/80 px-3 py-1 rounded-lg shadow-sm"><p className="text-[8px] font-bold text-slate-400 uppercase mb-0.5">滿 $4500 折</p><p className="text-sm font-black text-red-500 sport-nums">$500</p></div>
                                    </div>
                                    <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=400&q=80" className="absolute -bottom-4 -right-4 w-40 drop-shadow-lg rotate-[-12deg] opacity-90" />
                                </div>

                                <div 
                                    className="bg-white rounded-xl py-1.5 px-4 flex justify-between items-center border border-slate-100 shadow-sm min-h-[36px] active:scale-95 transition-all cursor-pointer"
                                    onClick={() => setCurrentView('points_detail')}
                                >
                                    <span className="text-[10px] font-black text-slate-800 tracking-wider italic uppercase">YY POINTS</span>
                                    <div className="flex items-center gap-2"><span className="text-xl font-bold text-[#d9433e] sport-nums">68061</span><div className="flex items-center gap-1 text-[9px] font-bold text-slate-400 border-l border-slate-100 pl-2 ml-1"><span>點 / 680元</span><Icon name="chevron-right" size={8}/></div></div>
                                </div>

                                <div className="bg-slate-50 border border-slate-100 rounded-lg h-8 overflow-hidden relative flex items-center shadow-inner">
                                    <div className="absolute left-0 bg-slate-50 z-10 px-2 flex items-center h-full text-slate-400 border-r border-slate-100"><Icon name="bell" size={14} /></div>
                                    <div className="marquee-container w-full"><div className="marquee-content text-[10px] font-bold text-slate-500 pl-8 uppercase tracking-wide">恭喜 Félix 達成連續 7 天運動！ • 週末揪團現正報名中 • 您的優惠券即將到期。</div></div>
                                </div>

                                <div className="grid grid-cols-3 gap-2 px-1 pt-2">
                                    {[{ label: "商城", icon: "store", color: "bg-orange-500" }, { label: "企業活動", icon: "briefcase", color: "bg-indigo-600" }, { label: "健身課程", icon: "dumbbell", color: "bg-emerald-500" }].map((item, idx) => (
                                        <div key={idx} className="flex flex-col items-center py-4 bg-white rounded-xl border border-slate-50 shadow-sm active:scale-95 transition-all">
                                            <div className={`w-10 h-10 ${item.color} rounded-xl flex items-center justify-center text-white mb-2 shadow-md`}><Icon name={item.icon} size={20} /></div>
                                            <span className="text-[10px] font-bold text-slate-700">{item.label}</span>
                                        </div>
                                    ))}
                                </div>

                                <div className="mt-4 space-y-4">
                                    <div className="flex justify-between items-center px-1">
                                        <h3 className="text-[12px] font-black italic text-slate-800 uppercase tracking-widest">最新消息 NEWS</h3>
                                        <button onClick={() => setCurrentView('my_registrations')} className="text-[10px] font-black text-[#d9433e] hover:text-red-700 transition-colors">我的報名 >></button>
                                    </div>
                                    
                                    {/* PONY Card */}
                                    <div className="rounded-2xl overflow-hidden shadow-md border border-slate-100 bg-white active:scale-[0.98] transition-all relative aspect-video group">
                                        <img 
                                            src="20260202-111729.jpg" 
                                            onError={(e) => e.target.src = 'https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?auto=format&fit=crop&w=600&q=80'}
                                            className="w-full h-full object-cover" 
                                            alt="PONY Event"
                                        />
                                        <div className="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4">
                                            <p className="text-white font-black italic text-[14px] uppercase">PONY 品牌代言人 任嘉倫</p>
                                            <p className="text-yellow-400 font-bold italic text-[10px] uppercase mt-1">加碼抽 全套代言人形象好禮</p>
                                        </div>
                                    </div>

                                    {/* NIKE Card */}
                                    <div className="rounded-2xl overflow-hidden shadow-md border border-slate-100 bg-white active:scale-[0.98] transition-all relative aspect-video group">
                                        <img 
                                            src="20260202-111739.jpg" 
                                            onError={(e) => e.target.src = 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=600&q=80'}
                                            className="w-full h-full object-cover" 
                                            alt="NIKE KOBE"
                                        />
                                        <div className="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4">
                                            <p className="text-white font-black italic text-[14px] uppercase">NIKE KOBE VIII PROTRO</p>
                                            <p className="text-orange-400 font-bold italic text-[10px] uppercase mt-1">Year of the Horse - 投籤開始</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    
                    case 'points_detail':
                        return (
                            <div className={containerClass}>
                                {/* Header */}
                                <header className="flex justify-between items-center mb-6 pt-2 px-1">
                                    <button onClick={() => setCurrentView('home')} className="w-10 h-10 bg-white rounded-xl border border-slate-100 flex items-center justify-center shadow-sm active:scale-95 transition-all">
                                        <Icon name="chevron-right" size={20} className="rotate-180 text-slate-600"/>
                                    </button>
                                    <h2 className="text-xl font-black italic text-slate-800 tracking-widest uppercase">YY POINTS</h2>
                                    <Icon name="info" size={24} className="text-slate-400" /> 
                                </header>

                                {/* Hero Card */}
                                <div className="bg-gradient-to-r from-slate-100 to-slate-200 rounded-3xl p-6 mb-6 relative overflow-hidden shadow-sm">
                                    {/* Background decoration elements */}
                                    <div className="absolute right-0 top-0 h-full w-1/3 bg-slate-300/20 skew-x-12"></div>
                                    <div className="absolute -right-6 -bottom-6 w-32 h-32 rounded-full border-[6px] border-slate-300/10"></div>
                                    
                                    <h1 className="text-5xl font-black text-slate-800 sport-nums mb-1 tracking-tight">
                                        68061<span className="text-lg text-slate-600 font-bold ml-1">點</span>
                                        <span className="text-2xl text-slate-400 mx-2 font-thin">/</span>
                                        <span className="text-2xl text-slate-600">680元</span>
                                    </h1>
                                    <div className="flex items-center gap-1 mt-2">
                                        <div className="w-1.5 h-1.5 rounded-full bg-orange-400"></div>
                                        <p className="text-[10px] text-slate-500 font-bold">您有 4810 點即將於 2026.02.27 過期</p>
                                    </div>
                                </div>

                                {/* 4 New Icons Grid */}
                                <div className="grid grid-cols-4 gap-3 mb-8 px-1">
                                    {[
                                        { label: '積分抵現金', icon: 'scan', color: 'bg-orange-100 text-orange-500' },
                                        { label: '積分兌換券', icon: 'ticket', color: 'bg-blue-100 text-blue-500' },
                                        { label: '積分兌換品', icon: 'store', color: 'bg-emerald-100 text-emerald-500' },
                                        { label: '積分混搭', icon: 'zap', color: 'bg-purple-100 text-purple-500' }
                                    ].map((item, i) => (
                                        <div key={i} className="flex flex-col items-center gap-2 group cursor-pointer">
                                            <div className={`w-14 h-14 rounded-2xl flex items-center justify-center ${item.color} shadow-sm group-active:scale-95 transition-all`}>
                                                <Icon name={item.icon} size={24} />
                                            </div>
                                            <span className="text-[9px] font-bold text-slate-600 text-center leading-tight">{item.label}</span>
                                        </div>
                                    ))}
                                </div>

                                {/* Tabs */}
                                <div className="flex border-b border-slate-100 mb-4 px-2">
                                    <button className="flex-1 pb-3 border-b-[3px] border-red-500 text-slate-800 font-black text-sm">點數紀錄</button>
                                    <button className="flex-1 pb-3 text-slate-400 font-bold text-sm">即將過期</button>
                                </div>

                                {/* List */}
                                <div className="space-y-4 px-1 pb-10">
                                   {[
                                       { title: "POS消費得點數", date: "2026.01.24", points: "+9905" },
                                       { title: "POS消費得點數", date: "2026.01.24", points: "+9905" },
                                       { title: "POS消費得點數", date: "2025.11.22", points: "+5565" },
                                       { title: "POS消費得點數", date: "2025.11.22", points: "+7420" },
                                       { title: "POS消費得點數", date: "2025.10.31", points: "+9716" },
                                       { title: "POS消費得點數", date: "2025.09.22", points: "+6720" },
                                   ].map((item, idx) => (
                                       <div key={idx} className="flex justify-between items-center py-2 border-b border-slate-50 last:border-0">
                                           <div>
                                               <h4 className="font-bold text-slate-800 text-sm mb-1">{item.title}</h4>
                                               <p className="text-[10px] text-slate-400 font-medium">{item.date}</p>
                                           </div>
                                           <div className="text-right">
                                               <p className="font-black text-slate-800 sport-nums text-lg">{item.points} <span className="text-xs font-bold">點</span></p>
                                               <Icon name="chevron-right" size={14} className="text-slate-300 inline-block rotate-90 mt-1" />
                                           </div>
                                       </div>
                                   ))}
                                </div>
                            </div>
                        );

                    case 'my_registrations':
                        return (
                            <div className={containerClass}>
                                <header className="flex items-center gap-4 pt-2 mb-4">
                                    <button onClick={() => setCurrentView('home')} className="w-10 h-10 bg-white rounded-xl border border-slate-100 flex items-center justify-center shadow-sm active:scale-95 transition-all">
                                        <Icon name="chevron-right" size={20} className="rotate-180 text-slate-600"/>
                                    </button>
                                    <h2 className="text-xl font-black italic text-slate-800 tracking-tight uppercase">我的報名</h2>
                                </header>

                                {/* 報名 Tab 切換 */}
                                <div className="flex bg-slate-100 p-1 rounded-xl mb-4">
                                    {['sports', 'activity'].map(tab => (
                                        <button
                                            key={tab}
                                            onClick={() => setRegistrationTab(tab)}
                                            className={`flex-1 py-2 rounded-lg text-[11px] font-black transition-all duration-300 ${registrationTab === tab ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}
                                        >
                                            {tab === 'sports' ? '運動報名' : '活動報名'}
                                        </button>
                                    ))}
                                </div>

                                <div className="space-y-3 animate-slide-up">
                                    {registrationTab === 'sports' && (
                                        <>
                                            {[
                                                { title: "有氧拳擊體驗", date: "2025/02/05 19:30", location: "內湖旗艦店", status: "已報名", statusColor: "bg-emerald-50 text-emerald-600" },
                                                { title: "TRX 懸吊訓練", date: "2025/02/08 10:00", location: "信義運動中心", status: "候補中", statusColor: "bg-orange-50 text-orange-500" },
                                                { title: "週五夜跑團", date: "2025/01/31 20:00", location: "大安森林公園", status: "已簽到", statusColor: "bg-slate-100 text-slate-500" }
                                            ].map((item, i) => (
                                                <div key={i} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex justify-between items-center active:scale-[0.98] transition-all">
                                                    <div>
                                                        <h4 className="font-black text-slate-800 text-sm mb-1">{item.title}</h4>
                                                        <p className="text-[10px] text-slate-400 font-bold">{item.date}</p>
                                                        <p className="text-[10px] text-slate-400 mt-0.5">{item.location}</p>
                                                    </div>
                                                    <span className={`px-2.5 py-1 rounded-lg text-[9px] font-black ${item.statusColor}`}>
                                                        {item.status}
                                                    </span>
                                                </div>
                                            ))}
                                        </>
                                    )}

                                    {registrationTab === 'activity' && (
                                        <>
                                            {[
                                                { title: "2025 台北馬拉松", date: "2025/12/20", type: "全馬組", status: "審核中", statusColor: "bg-blue-50 text-blue-500" },
                                                { title: "陽明山春季健行", date: "2025/03/15", type: "親子組", status: "已報名", statusColor: "bg-emerald-50 text-emerald-600" }
                                            ].map((item, i) => (
                                                <div key={i} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex justify-between items-center active:scale-[0.98] transition-all">
                                                    <div className="flex items-center gap-4">
                                                        <div className="w-10 h-10 rounded-xl bg-slate-50 flex items-center justify-center text-slate-400">
                                                            <Icon name="ticket" size={20} />
                                                        </div>
                                                        <div>
                                                            <h4 className="font-black text-slate-800 text-sm mb-1">{item.title}</h4>
                                                            <p className="text-[10px] text-slate-400 font-bold">{item.date} · {item.type}</p>
                                                        </div>
                                                    </div>
                                                    <span className={`px-2.5 py-1 rounded-lg text-[9px] font-black ${item.statusColor}`}>
                                                        {item.status}
                                                    </span>
                                                </div>
                                            ))}
                                        </>
                                    )}
                                </div>
                            </div>
                        );

                    case 'log':
                        // 視覺演示數據 (如果非 Demo 模式，會從 logs 狀態合併，這裡為了演示效果強制顯示特定日期數據)
                        const demoLog = {
                            id: 'demo-1',
                            type: '跑步',
                            date: '2025-01-26',
                            distance: '5.2',
                            duration: 38 * 60,
                            kcal: '420',
                            noteTime: '09:30',
                            noteContent: '完成竹科 Inbody 測量，數據顯示體脂正在穩定下降！',
                            hasMap: true
                        };

                        const demoLog25 = {
                            id: 'demo-25',
                            type: '戶外健走',
                            date: '2025-01-25',
                            distance: '3.2',
                            duration: 45 * 60,
                            kcal: '240',
                            noteTime: '17:20',
                            noteContent: '跟跑團一起跑感覺更有動力，里程輕鬆達標，下次挑戰配速！',
                            hasMap: true
                        };

                        let currentLogs = [];
                        if (selectedDate === 26) currentLogs = [demoLog];
                        else if (selectedDate === 25) currentLogs = [demoLog25];
                        // 混合真實數據
                        if (!isDemoMode && logs.length > 0) {
                            // 這裡可以做真實數據過濾，但為了演示保持 UI 完整性，暫時使用演示數據邏輯
                        }

                        return (
                            <div className={containerClass}>
                                {/* Header */}
                                <div className="flex justify-between items-center pt-2 mb-4">
                                    <h2 className="text-2xl font-black italic text-slate-800 tracking-tight">生活日誌 LOG</h2>
                                    <button className="bg-[#f97316] text-white w-10 h-10 rounded-xl flex items-center justify-center shadow-lg shadow-orange-500/20 active:scale-95 transition-all">
                                        <Icon name="plus" size={24} />
                                    </button>
                                </div>

                                {/* Stats Cards */}
                                <div className="bg-[#fff5f5] rounded-3xl p-5 mb-6 flex justify-between gap-3">
                                    <div className="bg-white rounded-2xl p-2 flex-1 text-center shadow-sm border border-red-50 py-3">
                                        <p className="text-[10px] text-slate-400 font-bold mb-1">本週里程</p>
                                        <p className="text-2xl font-black italic text-[#d9433e] sport-nums leading-none">26.2</p>
                                        <p className="text-[9px] text-slate-400 font-bold mt-1">km</p>
                                    </div>
                                    <div className="bg-white rounded-2xl p-2 flex-1 text-center shadow-sm border border-red-50 py-3">
                                        <p className="text-[10px] text-slate-400 font-bold mb-1">運動次數</p>
                                        <p className="text-2xl font-black italic text-[#d9433e] sport-nums leading-none">4</p>
                                        <p className="text-[9px] text-slate-400 font-bold mt-1">次</p>
                                    </div>
                                    <div className="bg-white rounded-2xl p-2 flex-1 text-center shadow-sm border border-red-50 py-3">
                                        <p className="text-[10px] text-slate-400 font-bold mb-1">消耗卡路里</p>
                                        <p className="text-2xl font-black italic text-[#d9433e] sport-nums leading-none">1.7k</p>
                                        <p className="text-[9px] text-slate-400 font-bold mt-1">kcal</p>
                                    </div>
                                </div>

                                {/* Calendar (New Style) */}
                                <div className="bg-white rounded-[2.5rem] p-6 shadow-sm border border-slate-50 mb-6">
                                    {/* Month/Year Header with Arrows */}
                                    <div className="flex justify-between items-center mb-4 px-2">
                                        <button className="text-slate-300 hover:text-slate-600"><Icon name="chevron-right" className="rotate-180" size={20}/></button>
                                        <h3 className="text-sm font-black italic text-slate-800 tracking-wider">2026.02</h3>
                                        <button className="text-slate-300 hover:text-slate-600"><Icon name="chevron-right" size={20}/></button>
                                    </div>
                                    
                                    {/* Days Grid */}
                                    <div className="grid grid-cols-7 gap-2 mb-2">
                                        {['S','M','T','W','T','F','S'].map((d, i) => (
                                            <div key={i} className="text-[10px] font-bold italic text-slate-300 text-center">{d}</div>
                                        ))}
                                    </div>
                                    <div className="grid grid-cols-7 gap-2">
                                        {[20, 21, 22, 23, 24, 25, 26].map(d => {
                                            const isSelected = selectedDate === d;
                                            
                                            return (
                                                <button key={d} onClick={() => setSelectedDate(d)} className="flex flex-col items-center justify-start relative group">
                                                    <div className={`w-9 h-9 rounded-xl flex items-center justify-center text-sm font-black italic sport-nums transition-all ${isSelected ? 'bg-[#1e1b4b] text-white shadow-md scale-110 -translate-y-1' : 'text-slate-400 hover:text-slate-600'}`}>
                                                        {d}
                                                    </div>
                                                    {/* Orange dots for event indicators */}
                                                    {(d === 25 || d === 26) && (
                                                        <div className="w-1.5 h-1.5 rounded-full bg-orange-500 mt-2"></div>
                                                    )}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>

                                {/* Workout Card (Keep existing) */}
                                <div className="space-y-6">
                                    {currentLogs.length > 0 ? currentLogs.map(log => (
                                        <div key={log.id} className="bg-white rounded-[2.5rem] shadow-[0_10px_40px_-10px_rgba(0,0,0,0.08)] overflow-hidden border border-slate-50 animate-slide-up relative">
                                            {/* Share Button Overlay */}
                                            <button onClick={() => { setActiveShareData(log); setShowShareModal(true); }} className="absolute top-6 right-6 text-slate-300 hover:text-[#f97316] z-10"><Icon name="share" size={20}/></button>

                                            {/* Top Info */}
                                            <div className="p-6 pb-2">
                                                <div className="flex justify-between items-start mb-5">
                                                    <h3 className="text-lg font-black italic text-slate-800">{log.type}</h3>
                                                    <span className="text-[10px] text-slate-400 font-bold sport-nums pr-8">{log.date}</span>
                                                </div>
                                                <div className="flex justify-between items-end px-2 mb-4">
                                                    <div className="text-center">
                                                        <p className="text-3xl font-black italic text-[#d9433e] sport-nums leading-none">{log.distance} <span className="text-sm">km</span></p>
                                                        <p className="text-[9px] font-bold text-slate-400 mt-1">距離</p>
                                                    </div>
                                                    <div className="text-center">
                                                        <p className="text-3xl font-black italic text-slate-800 sport-nums leading-none">38 <span className="text-sm">分</span></p>
                                                        <p className="text-[9px] font-bold text-slate-400 mt-1">時間</p>
                                                    </div>
                                                    <div className="text-center">
                                                        <p className="text-3xl font-black italic text-slate-800 sport-nums leading-none">{log.kcal} <span className="text-sm">kcal</span></p>
                                                        <p className="text-[9px] font-bold text-slate-400 mt-1">卡路里</p>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Map Area */}
                                            <div className="h-40 w-full bg-slate-100 relative">
                                                 <MapThumbnail currentPos={[25.033, 121.565]} />
                                            </div>

                                            {/* Note Area */}
                                            <div className="p-6 pt-5">
                                                <div className="flex items-center gap-2 mb-3">
                                                    <span className="text-[11px] font-black italic text-[#f97316] tracking-wide">{log.noteTime} • 心得筆記</span>
                                                </div>
                                                <p className="text-[13px] font-bold text-slate-600 leading-relaxed italic text-justify">
                                                    {log.noteContent}
                                                </p>
                                            </div>
                                        </div>
                                    )) : (
                                        <div className="py-12 text-center text-slate-300 italic font-bold">選擇日期查看紀錄</div>
                                    )}
                                </div>
                            </div>
                        );
                    case 'fun_sports':
                        return (
                            <div className={containerClass}>
                                <h2 className="text-xl font-black italic text-slate-800 uppercase pt-2">趣動 Fun Sports</h2>
                                
                                <div className="flex bg-slate-100 p-1 rounded-xl mb-4 shadow-inner">
                                    {['exercise', 'task', 'experience'].map(tab => (
                                        <button 
                                            key={tab} 
                                            onClick={() => setFunSportsTab(tab)} 
                                            className={`flex-1 py-3 rounded-lg text-[10px] font-black italic uppercase transition-all ${funSportsTab === tab ? 'bg-white text-slate-900 shadow-md' : 'text-slate-400'}`}
                                        >
                                            {tab === 'exercise' ? '運動' : tab === 'task' ? '任務' : '體驗'}
                                        </button>
                                    ))}
                                </div>

                                {funSportsTab === 'exercise' && (
                                    <div className="space-y-4 animate-slide-up">
                                        <div onClick={() => setCurrentView('exercise_prep')} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 active:scale-95 transition-all">
                                            <div className="w-12 h-12 rounded-xl bg-orange-50 text-orange-500 flex items-center justify-center">
                                                <Icon name="activity" size={24} />
                                            </div>
                                            <div className="flex-1">
                                                <h4 className="font-black italic text-slate-800 text-sm">個人運動模式</h4>
                                                <p className="text-[10px] font-bold text-slate-400 mt-0.5">Outdoor · Indoor</p>
                                            </div>
                                            <button className="bg-slate-900 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold shadow-lg shadow-slate-300/50">GO</button>
                                        </div>

                                        <div onClick={() => {setTeamStep('activity'); setCurrentView('team_room');}} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 active:scale-95 transition-all">
                                            <div className="w-12 h-12 rounded-xl bg-indigo-50 text-indigo-500 flex items-center justify-center">
                                                <Icon name="users" size={24} />
                                            </div>
                                            <div className="flex-1">
                                                <h4 className="font-black italic text-slate-800 text-sm">組隊挑戰</h4>
                                                <p className="text-[10px] font-bold text-slate-400 mt-0.5">Join Team Challenge</p>
                                            </div>
                                            <button className="bg-slate-900 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold shadow-lg shadow-slate-300/50">參加</button>
                                        </div>

                                        <div onClick={() => setCurrentView('activity_center')} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 active:scale-95 transition-all">
                                            <div className="w-12 h-12 rounded-xl bg-emerald-50 text-emerald-500 flex items-center justify-center">
                                                <Icon name="ticket" size={24} />
                                            </div>
                                            <div className="flex-1">
                                                <h4 className="font-black italic text-slate-800 text-sm">活動中心</h4>
                                                <p className="text-[10px] font-bold text-slate-400 mt-0.5">個人報名</p>
                                            </div>
                                            <button className="bg-slate-900 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold shadow-lg shadow-slate-300/50">報名</button>
                                        </div>
                                    </div>
                                )}

                                {funSportsTab === 'task' && (
                                     <div className="space-y-6 animate-slide-up">
                                        <div className="flex flex-col gap-4">
                                            <h3 className="text-lg font-black italic text-slate-800 uppercase tracking-tight">個人目標中心 Goals</h3>
                                            <div className="flex bg-slate-100 p-1 rounded-xl">
                                                {['當日', '本週', '本月'].map(p => (
                                                    <button
                                                        key={p}
                                                        onClick={() => setTaskPeriod(p)}
                                                        className={`flex-1 py-2 rounded-lg text-[11px] font-black italic transition-all duration-300 ${taskPeriod === p ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}
                                                    >
                                                        {p}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {(() => {
                                            const dataMap = {
                                                '當日': { steps: { curr: '8,542', total: '10,000', pct: 85 }, dist: { curr: '4.2', total: '5', pct: 84 } },
                                                '本週': { steps: { curr: '8,542', total: '100,000', pct: 8.5 }, dist: { curr: '4.2', total: '10', pct: 42 } },
                                                '本月': { steps: { curr: '8,542', total: '15,000', pct: 56 }, dist: { curr: '4.2', total: '10', pct: 42 } }
                                            };
                                            const currentData = dataMap[taskPeriod];

                                            return (
                                                <div className="grid grid-cols-1 gap-4">
                                                     {/* Steps Card - Compact Design */}
                                                     <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm relative overflow-hidden group">
                                                        <div className="absolute right-0 top-0 w-20 h-20 bg-orange-50 rounded-full -mr-6 -mt-6 z-0"></div>
                                                        <div className="relative z-10 flex flex-col gap-3">
                                                            <div className="flex justify-between items-center">
                                                                <div className="flex items-center gap-2">
                                                                    <div className="w-8 h-8 rounded-lg bg-orange-100 text-orange-500 flex items-center justify-center">
                                                                        <Icon name="zap" size={16} />
                                                                    </div>
                                                                    <span className="text-xs font-black italic text-slate-500 uppercase">步數進度</span>
                                                                </div>
                                                                <span className="text-lg font-black italic text-orange-500 sport-nums">{currentData.steps.pct}%</span>
                                                            </div>
                                                            <div className="flex items-baseline gap-1">
                                                                <span className="text-2xl font-black italic text-slate-800 sport-nums">{currentData.steps.curr}</span>
                                                                <span className="text-[10px] font-bold text-slate-400">/ {currentData.steps.total}</span>
                                                            </div>
                                                            <div className="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                                                                <div className="bg-gradient-to-r from-orange-400 to-red-500 h-full rounded-full transition-all duration-1000 ease-out" style={{width: `${currentData.steps.pct}%`}}></div>
                                                            </div>
                                                        </div>
                                                     </div>

                                                     {/* Distance Card - Compact Design */}
                                                     <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm relative overflow-hidden group">
                                                        <div className="absolute right-0 top-0 w-20 h-20 bg-indigo-50 rounded-full -mr-6 -mt-6 z-0"></div>
                                                        <div className="relative z-10 flex flex-col gap-3">
                                                            <div className="flex justify-between items-center">
                                                                <div className="flex items-center gap-2">
                                                                    <div className="w-8 h-8 rounded-lg bg-indigo-100 text-indigo-500 flex items-center justify-center">
                                                                        <Icon name="map-pin" size={16} />
                                                                    </div>
                                                                    <span className="text-xs font-black italic text-slate-500 uppercase">里程挑戰</span>
                                                                </div>
                                                                <span className="text-lg font-black italic text-indigo-500 sport-nums">{currentData.dist.pct}%</span>
                                                            </div>
                                                            <div className="flex items-baseline gap-1">
                                                                <span className="text-2xl font-black italic text-slate-800 sport-nums">{currentData.dist.curr}</span>
                                                                <span className="text-[10px] font-bold text-slate-400">/ {currentData.dist.total} km</span>
                                                            </div>
                                                            <div className="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                                                                <div className="bg-gradient-to-r from-indigo-400 to-purple-500 h-full rounded-full transition-all duration-1000 ease-out" style={{width: `${currentData.dist.pct}%`}}></div>
                                                            </div>
                                                        </div>
                                                     </div>
                                                </div>
                                            );
                                        })()}

                                        {/* Rewards Section */}
                                        <div>
                                             <h3 className="text-[11px] font-black italic text-slate-400 uppercase tracking-widest ml-1 mb-3">挑戰獎勵 Rewards</h3>
                                             <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 active:scale-95 transition-all relative overflow-hidden">
                                                <div className="w-12 h-12 bg-slate-800 rounded-xl flex items-center justify-center text-yellow-400 shadow-lg shadow-slate-200/50">
                                                    <Icon name="compass" size={24} />
                                                </div>
                                                <div className="flex-1 min-w-0">
                                                    <div className="flex justify-between items-start">
                                                        <h4 className="font-black italic text-slate-800 text-sm truncate">城市探險家</h4>
                                                        <span className="bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded text-[9px] font-black italic border border-yellow-200 shadow-sm">
                                                            $50 券
                                                        </span>
                                                    </div>
                                                    <p className="text-[10px] text-slate-400 font-bold mt-0.5 uppercase tracking-wide truncate">里程挑戰系列</p>
                                                    <p className="text-[10px] text-slate-500 mt-1 truncate">累計里程達 50km 即可領取獎勵。</p>
                                                </div>
                                             </div>
                                        </div>
                                     </div>
                                )}
                                
                                {funSportsTab === 'experience' && (
                                    <div className="space-y-4 animate-slide-up">
                                        <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 active:scale-95 transition-all">
                                            <div className="w-12 h-12 rounded-xl bg-blue-50 text-blue-500 flex items-center justify-center">
                                                <Icon name="activity" size={24} />
                                            </div>
                                            <div className="flex-1">
                                                <h4 className="font-black italic text-slate-800 text-sm">身體數值分析</h4>
                                                <p className="text-[10px] font-bold text-slate-400 mt-0.5">YYsports-Inbody 數據記錄</p>
                                            </div>
                                            <button className="bg-slate-900 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold shadow-lg shadow-slate-300/50">預約</button>
                                        </div>

                                        <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 active:scale-95 transition-all">
                                            <div className="w-12 h-12 rounded-xl bg-orange-50 text-orange-500 flex items-center justify-center">
                                                <Icon name="store" size={24} />
                                            </div>
                                            <div className="flex-1">
                                                <h4 className="font-black italic text-slate-800 text-sm">新竹科學園區</h4>
                                                <p className="text-[10px] font-bold text-slate-400 mt-0.5">園區科技跑者專屬服務</p>
                                            </div>
                                            <button className="bg-slate-900 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold shadow-lg shadow-slate-300/50">查看</button>
                                        </div>

                                        <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 active:scale-95 transition-all">
                                            <div className="w-12 h-12 rounded-xl bg-indigo-50 text-indigo-500 flex items-center justify-center">
                                                <Icon name="scan" size={24} />
                                            </div>
                                            <div className="flex-1">
                                                <h4 className="font-black italic text-slate-800 text-sm">工研院-肌能鏡</h4>
                                                <p className="text-[10px] font-bold text-slate-400 mt-0.5">智能姿勢分析體驗</p>
                                            </div>
                                            <button className="bg-slate-900 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold shadow-lg shadow-slate-300/50">體驗</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        );
                    case 'team_room':
                        return (
                            <div className={containerClass}>
                                <header className="flex items-center gap-4 pt-2 mb-4">
                                    <button onClick={() => { if (teamStep === 'activity') setCurrentView('fun_sports'); else if (teamStep === 'list') setTeamStep('activity'); else if (teamStep === 'room') setTeamStep('list'); else setTeamStep('list'); }} className="w-10 h-10 bg-white rounded-xl border border-slate-100 flex items-center justify-center shadow-sm active:scale-95 transition-all">
                                        <Icon name="chevron-right" size={20} className="rotate-180 text-slate-600"/>
                                    </button>
                                    <h2 className="text-xl font-black italic text-slate-800 tracking-tight uppercase">組隊挑戰</h2>
                                </header>
                                
                                {teamStep === 'activity' && (
                                    <div className="space-y-3 animate-slide-up">
                                        <div className="flex items-center justify-between mb-2">
                                            <p className="text-[10px] font-black italic text-slate-400 uppercase tracking-widest bg-slate-100 px-3 py-1 rounded-full">Step 1: 選擇挑戰活動</p>
                                        </div>
                                        
                                        {[
                                            { title: "河濱公園 5KM 競速", desc: "追求極致配速的組隊挑戰", icon: "activity", color: "bg-orange-500" }, 
                                            { title: "萬步達標挑戰賽", desc: "每日萬步，健康生活起點", icon: "task", color: "bg-indigo-600" }, 
                                            { title: "跨年登高賽 (101級)", desc: "模擬爬樓梯高強度訓練", icon: "zap", color: "bg-slate-900" }
                                        ].map((act, i) => (
                                            <div key={i} onClick={() => {setTeamStep('list');}} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 active:scale-95 transition-all cursor-pointer group hover:border-slate-200">
                                                <div className={`w-12 h-12 ${act.color} rounded-xl flex items-center justify-center text-white shadow-lg group-hover:rotate-6 transition-transform`}>
                                                    <Icon name={act.icon} size={24}/>
                                                </div>
                                                <div className="flex-1">
                                                    <h4 className="font-black italic text-slate-800 text-sm uppercase">{act.title}</h4>
                                                    <p className="text-[10px] font-bold text-slate-400 mt-0.5 italic">{act.desc}</p>
                                                </div>
                                                <div className="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center group-hover:bg-slate-100 transition-colors">
                                                    <Icon name="chevron-right" size={16} className="text-slate-400" />
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {teamStep === 'list' && <div className="space-y-5 animate-slide-up"><div><p className="text-[9px] font-black italic text-orange-500 uppercase tracking-widest">河濱公園 5KM 競速</p><h3 className="text-lg font-black italic text-slate-800 uppercase tracking-tight">Step 2: 房間列表</h3></div><div className="space-y-4">{[{ name: "超速跑團", members: 3, max: 4, host: "Allen" }, { name: "健康走走隊", members: 2, max: 4, host: "Jane" }].map((room, i) => (<div key={i} onClick={() => setTeamStep('room')} className="bg-white p-6 rounded-[2.2rem] border border-slate-100 flex justify-between items-center active:scale-95 transition-all cursor-pointer shadow-sm hover:shadow-md"><div className="flex items-center gap-4"><img src={`https://api.dicebear.com/7.x/bottts-neutral/svg?seed=${room.host}`} className="w-12 h-12 rounded-xl bg-slate-50 border border-slate-100 shadow-sm" /><div><h4 className="font-black italic text-slate-800 text-base tracking-tight">{room.name}</h4><p className="text-[9px] font-bold text-slate-400 italic mt-1.5">房主: {room.host}</p></div></div><div className="text-right"><span className="text-xs font-black italic text-indigo-600 sport-nums">{room.members}/{room.max}</span></div></div>))}</div></div>}
                                {teamStep === 'room' && (
                                    <div className="space-y-6 animate-slide-up">
                                        <div className="bg-indigo-600 rounded-3xl p-7 text-white shadow-xl relative overflow-hidden group">
                                            <div className="absolute top-[-10px] right-[-10px] p-6 opacity-10 group-hover:rotate-12 duration-700">
                                                <Icon name="users" size={120} />
                                            </div>
                                            <div className="relative z-10 flex justify-between items-start">
                                                <div><h3 className="text-xl font-black italic leading-tight uppercase">河濱挑戰賽</h3><p className="text-[9px] font-bold text-indigo-200 mt-2 opacity-60 uppercase">Room ID: YY-7788</p></div>
                                                <button className="bg-white text-indigo-600 px-4 py-2 rounded-xl text-[10px] font-black italic shadow-xl flex items-center gap-2 active:scale-95 shadow-indigo-700/20"><Icon name="share" size={14} /> 邀請</button>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-5 pt-1">
                                            {[
                                                { name: "Félix (你)", isHost: true, isReady: true, avatar: "Felix" },
                                                { name: "Allen Chen", isHost: false, isReady: true, avatar: "Allen" },
                                                { name: "Jane Doe", isHost: false, isReady: false, avatar: "Jane" },
                                                { name: "待加入", isHost: false, isReady: false, avatar: null }
                                            ].map((m, idx) => (
                                                <div key={idx} className={`bg-white p-8 rounded-3xl border border-slate-100 text-center relative shadow-sm ${!m.avatar && 'opacity-40 border-dashed border'}`}>
                                                    {m.avatar ? (
                                                        <div className="flex flex-col items-center gap-5">
                                                            <div className="relative w-16 h-16"><img src={`https://api.dicebear.com/7.x/bottts-neutral/svg?seed=${m.avatar}`} className="w-full h-full rounded-2xl shadow-lg border-2 border-white object-cover" />{m.isHost && <div className="absolute -top-1.5 -right-2.5 host-tag text-[7px] text-white font-black italic px-2 py-0.5 rounded-md border border-white/5 shadow-md uppercase">HOST</div>}</div>
                                                            <p className="text-[11px] font-black italic text-slate-800 truncate w-full px-2">{m.name}</p>
                                                            <span className={`text-[9px] font-black italic uppercase px-3 py-1 rounded-full border ${m.isReady ? 'bg-emerald-50 text-emerald-500 border-emerald-100' : 'bg-slate-50 text-slate-300'}`}>{m.isReady ? '✓ Ready' : 'Waiting...'}</span>
                                                        </div>
                                                    ) : (
                                                        <div className="flex flex-col items-center justify-center py-10 text-slate-200"><Icon name="plus" size={36} /></div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                        <button className="w-full bg-slate-900 py-6 rounded-2xl text-white font-black italic uppercase tracking-[0.4em] shadow-xl active:scale-95 border-b-8 border-slate-950 mt-4 shadow-slate-900/30 font-bold">準備就緒 Ready!</button>
                                    </div>
                                )}
                            </div>
                        );
                    case 'exercise_prep':
                        return (
                            <div className={containerClass}>
                                {/* Header - Compact & Clean */}
                                <header className="flex items-center gap-4 pt-2 mb-6">
                                    <button onClick={() => setCurrentView('fun_sports')} className="w-10 h-10 bg-white rounded-xl border border-slate-100 flex items-center justify-center shadow-sm active:scale-95 transition-all">
                                        <Icon name="chevron-right" size={20} className="rotate-180 text-slate-600"/>
                                    </button>
                                    <div>
                                        <h2 className="text-lg font-black italic text-slate-800 leading-tight">個人運動模式</h2>
                                        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Outdoor · Indoor</p>
                                    </div>
                                </header>

                                {/* Map Visualization - Aesthetic Frame */}
                                <div className="relative w-full h-48 bg-slate-100 rounded-[1.5rem] overflow-hidden shadow-sm border border-slate-100 mb-6 group">
                                    <MapThumbnail currentPos={currentLatLng} />
                                    
                                    {/* GPS Status Overlay */}
                                    <div className="absolute top-4 left-4 bg-white/90 backdrop-blur-md pl-2 pr-3 py-1.5 rounded-full flex items-center gap-2 shadow-sm border border-white/50">
                                        <div className="relative flex h-2.5 w-2.5">
                                          <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                          <span className="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
                                        </div>
                                        <span className="text-[9px] font-black text-slate-700 uppercase tracking-wide">GPS 鎖定就緒</span>
                                    </div>

                                    {/* Instruction Overlay */}
                                    <div className="absolute bottom-4 left-4 right-4">
                                        <div className="bg-slate-900/80 backdrop-blur-md p-3 rounded-xl text-center border border-white/10">
                                            <p className="text-[10px] font-bold text-white/90">適合戶外路跑。立即點擊下方按鈕開始！</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Mode Selection - Compact List */}
                                <div className="space-y-3">
                                    {['戶外跑步', '室內跑步', '城市健走'].map(mode => {
                                        const isSelected = exerciseMode === mode;
                                        let iconName = 'activity';
                                        if (mode === '室內跑步') iconName = 'dumbbell';
                                        if (mode === '城市健走') iconName = 'map-pin';

                                        return (
                                            <div key={mode} onClick={() => setExerciseMode(mode)} 
                                                 className={`flex items-center justify-between p-3.5 rounded-2xl border transition-all cursor-pointer active:scale-[0.98] ${isSelected ? 'border-orange-500 bg-orange-50/30 shadow-md ring-1 ring-orange-500/20' : 'border-slate-100 bg-white hover:border-slate-200'}`}>
                                                <div className="flex items-center gap-4">
                                                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${isSelected ? 'bg-orange-500 text-white shadow-lg shadow-orange-500/30' : 'bg-slate-100 text-slate-400'}`}>
                                                        <Icon name={iconName} size={20}/>
                                                    </div>
                                                    <h4 className={`font-black italic text-sm ${isSelected ? 'text-slate-800' : 'text-slate-500'}`}>{mode}</h4>
                                                </div>
                                                <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${isSelected ? 'border-orange-500' : 'border-slate-200'}`}>
                                                    {isSelected && <div className="w-2.5 h-2.5 rounded-full bg-orange-500"></div>}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* Start Button */}
                                <button onClick={startTracking} className="w-full bg-slate-900 text-white py-4 rounded-2xl font-black italic text-lg shadow-xl shadow-slate-900/20 active:scale-95 transition-all mt-6 flex items-center justify-center gap-2 group">
                                    <span>Start GO!</span>
                                    <Icon name="chevron-right" size={18} className="group-hover:translate-x-1 transition-transform" />
                                </button>
                            </div>
                        );
                    case 'run_tracking':
                        return (
                            <div className="flex flex-col h-full bg-[#020617] text-white p-8 relative overflow-hidden animate-slide-up">
                                <header className="flex justify-between items-center mb-16 z-20"><div className="flex items-center gap-3"><div className="w-2.5 h-2.5 rounded-full bg-emerald-500 animate-pulse"></div><span className="text-[11px] font-black italic uppercase text-emerald-400 sport-nums tracking-widest">GPS LIVE ACTIVE</span></div><h3 className="text-[11px] font-black italic uppercase tracking-widest text-slate-500">{exerciseMode}</h3></header>
                                <div className="text-center mb-16 z-20"><p className="text-[12px] font-black italic text-orange-500 uppercase tracking-widest mb-1 italic">Distance (KM)</p><h2 className="text-[100px] font-black italic sport-nums tracking-tighter leading-none">{trackDist.toFixed(2)}</h2></div>
                                <div className="relative w-full h-48 rounded-[3rem] overflow-hidden shadow-2xl border border-white/5 bg-[#0a0b1a] z-20">
                                    <MapThumbnail currentPos={currentLatLng} />
                                    <div className="absolute top-5 right-5 z-30"><button onClick={() => setCurrentLatLng([...currentLatLng])} className="w-12 h-12 bg-white/95 rounded-2xl flex items-center justify-center text-slate-900 shadow-xl active:scale-90"><Icon name="navigation" size={22}/></button></div>
                                </div>
                                <div className="grid grid-cols-2 gap-12 border-t border-white/5 pt-12 text-center z-20">
                                    <div><p className="text-[11px] font-black italic text-slate-500 uppercase mb-3">Duration</p><p className="text-5xl font-black italic sport-nums tabular-nums leading-none">{formatDuration(trackTime)}</p></div>
                                    <div><p className="text-[11px] font-black italic text-slate-500 uppercase mb-3">Pace</p><p className="text-5xl font-black italic sport-nums tabular-nums leading-none">{trackDist > 0 ? ((trackTime/60)/trackDist).toFixed(1) : "0.0"}</p></div>
                                </div>
                                <div className="mt-auto flex gap-6 z-30 pb-4"><button onClick={stopTracking} className="flex-1 bg-rose-500 py-8 rounded-[2.5rem] font-black italic uppercase tracking-[0.3em] text-sm shadow-xl active:scale-95 border-rose-700 border-b-8">Stop</button></div>
                            </div>
                        );
                    
                    case 'activity_center':
                        return (
                            <div className={containerClass}>
                                <header className="flex items-center gap-4 pt-2 mb-6">
                                    <button onClick={() => setCurrentView('fun_sports')} className="w-10 h-10 bg-white rounded-xl border border-slate-100 flex items-center justify-center shadow-sm active:scale-95 transition-all">
                                        <Icon name="chevron-right" size={20} className="rotate-180 text-slate-600"/>
                                    </button>
                                    <h2 className="text-xl font-black italic text-slate-800 tracking-tight uppercase">活動中心</h2>
                                </header>
                                
                                <div className="space-y-6 animate-slide-up">
                                    {/* Ball Games */}
                                    <div>
                                        <h3 className="text-[11px] font-black italic text-slate-400 uppercase tracking-widest ml-1 mb-3">球類活動</h3>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="bg-white p-4 rounded-2xl border border-slate-100 flex items-center gap-3 shadow-sm active:scale-95 transition-all">
                                                <div className="w-10 h-10 bg-orange-500 rounded-xl flex items-center justify-center text-white shadow-md">
                                                    <Icon name="basketball" size={20}/>
                                                </div>
                                                <span className="font-black italic text-slate-700 text-sm">籃球</span>
                                            </div>
                                            <div className="bg-white p-4 rounded-2xl border border-slate-100 flex items-center gap-3 shadow-sm active:scale-95 transition-all">
                                                <div className="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-md">
                                                    <Icon name="badminton" size={20}/>
                                                </div>
                                                <span className="font-black italic text-slate-700 text-sm">羽球</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Running Events */}
                                    <div>
                                        <h3 className="text-[11px] font-black italic text-slate-400 uppercase tracking-widest ml-1 mb-3">跑步活動</h3>
                                        <div className="space-y-3">
                                            {/* Event 1 */}
                                            <div className="bg-white p-4 rounded-2xl border border-slate-100 flex items-center gap-4 shadow-sm active:scale-95 transition-all">
                                                <div className="w-12 h-12 bg-emerald-500 rounded-xl flex items-center justify-center text-white shadow-lg">
                                                    <Icon name="activity" size={24}/>
                                                </div>
                                                <div className="flex-1">
                                                    <h4 className="font-black italic text-slate-800 text-sm">週末河濱公益跑</h4>
                                                    <p className="text-[10px] font-bold text-slate-400 mt-0.5">台北市 · 5KM Challenge</p>
                                                </div>
                                                <div className="bg-slate-50 px-2 py-1 rounded-lg text-center min-w-[50px]">
                                                    <span className="block text-[8px] font-bold text-slate-400 uppercase">Jan</span>
                                                    <span className="block text-sm font-black text-slate-800 sport-nums leading-none">30</span>
                                                </div>
                                            </div>

                                            {/* Event 2 */}
                                            <div className="bg-white p-4 rounded-2xl border border-slate-100 flex items-center gap-4 shadow-sm active:scale-95 transition-all">
                                                <div className="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center text-white shadow-lg">
                                                    <Icon name="navigation" size={24}/>
                                                </div>
                                                <div className="flex-1">
                                                    <h4 className="font-black italic text-slate-800 text-sm">台北晨跑</h4>
                                                    <p className="text-[10px] font-bold text-slate-400 mt-0.5">大安森林公園 · Morning Run</p>
                                                </div>
                                                <div className="bg-slate-50 px-2 py-1 rounded-lg text-center min-w-[50px]">
                                                    <span className="block text-[8px] font-bold text-slate-400 uppercase">Feb</span>
                                                    <span className="block text-sm font-black text-slate-800 sport-nums leading-none">02</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    case 'profile':
                        return (
                            <div className={containerClass}>
                                <header className="flex justify-between items-center mb-8 pt-2 px-1">
                                     <button onClick={() => {setCurrentView('home'); setActiveTab('home');}} className="w-10 h-10 bg-white rounded-xl border border-slate-100 flex items-center justify-center shadow-sm active:scale-95 transition-all">
                                        <Icon name="chevron-right" size={20} className="rotate-180 text-slate-600"/>
                                    </button>
                                     <h2 className="text-2xl font-black italic text-slate-800 tracking-tight">會員中心</h2>
                                     <Icon name="settings" size={24} className="text-slate-400" />
                                </header>
                    
                                {/* User Profile Summary */}
                                <div className="flex items-center gap-4 mb-8 px-1">
                                     <img src={userAvatar} className="w-20 h-20 rounded-full border-4 border-white shadow-lg bg-slate-100" />
                                     <div>
                                         <h3 className="text-xl font-black text-slate-800">Mac</h3>
                                         <p className="text-xs font-bold text-slate-400 mt-1">Gold Member</p>
                                     </div>
                                </div>
                    
                                {/* Menu Grid */}
                                <div className="grid grid-cols-2 gap-3 px-1">
                                    {/* My Points */}
                                    <div onClick={() => setCurrentView('points_detail')} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex flex-col items-center gap-3 active:scale-95 transition-all cursor-pointer">
                                        <div className="w-12 h-12 bg-orange-100 text-orange-500 rounded-xl flex items-center justify-center">
                                             <span className="font-black text-lg">P</span>
                                        </div>
                                        <span className="font-bold text-slate-700 text-sm">我的點數</span>
                                    </div>
                    
                                    {/* My Coupons */}
                                    <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex flex-col items-center gap-3 active:scale-95 transition-all cursor-pointer">
                                         <div className="w-12 h-12 bg-red-100 text-red-500 rounded-xl flex items-center justify-center">
                                             <Icon name="ticket" size={24} />
                                         </div>
                                         <span className="font-bold text-slate-700 text-sm">我的優惠券</span>
                                    </div>
                    
                                    {/* Consumption Records */}
                                    <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex flex-col items-center gap-3 active:scale-95 transition-all cursor-pointer">
                                         <div className="w-12 h-12 bg-blue-100 text-blue-500 rounded-xl flex items-center justify-center">
                                             <Icon name="file-text" size={24} />
                                         </div>
                                         <span className="font-bold text-slate-700 text-sm">消費紀錄</span>
                                    </div>
                    
                                    {/* My Registrations */}
                                    <div onClick={() => setCurrentView('my_registrations')} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex flex-col items-center gap-3 active:scale-95 transition-all cursor-pointer">
                                         <div className="w-12 h-12 bg-emerald-100 text-emerald-500 rounded-xl flex items-center justify-center">
                                             <Icon name="activity" size={24} />
                                         </div>
                                         <span className="font-bold text-slate-700 text-sm">我的報名</span>
                                    </div>
                    
                                     {/* My Courses */}
                                    <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex flex-col items-center gap-3 active:scale-95 transition-all cursor-pointer">
                                         <div className="w-12 h-12 bg-purple-100 text-purple-500 rounded-xl flex items-center justify-center">
                                             <Icon name="dumbbell" size={24} />
                                         </div>
                                         <span className="font-bold text-slate-700 text-sm">我的課程</span>
                                    </div>
                                     
                                     {/* Settings */}
                                    <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex flex-col items-center gap-3 active:scale-95 transition-all cursor-pointer">
                                         <div className="w-12 h-12 bg-slate-100 text-slate-500 rounded-xl flex items-center justify-center">
                                             <Icon name="settings" size={24} />
                                         </div>
                                         <span className="font-bold text-slate-700 text-sm">帳號設定</span>
                                    </div>
                                </div>
                            </div>
                        );
                    
                    default: return null;
                }
            };

            return (
                <div className="app-container no-scrollbar">
                    <div className="app-notch"></div>
                    <main className="flex-1 overflow-y-auto no-scrollbar pt-10 bg-white">
                        {renderMain()}
                    </main>

                    {showMenu && (
                        <div className="fixed inset-0 z-[100]">
                            <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={() => setShowMenu(false)}></div>
                            <div className="absolute top-0 left-0 h-full w-3/4 max-w-xs bg-white shadow-2xl p-8 animate-slide-right">
                                <div className="flex justify-between items-center mb-10">
                                    <div className="text-3xl font-black italic text-red-600">YY</div>
                                    <button onClick={() => setShowMenu(false)}><Icon name="x" size={24} className="text-slate-400" /></button>
                                </div>
                                <ul className="space-y-8">
                                    <li className="flex items-center gap-5 text-lg font-bold text-slate-700 active:text-red-500"><Icon name="file-text" size={22} /> 會員規章</li>
                                    <li className="flex items-center gap-5 text-lg font-bold text-slate-700 active:text-red-500"><Icon name="shield" size={22} /> 隱私權益政策</li>
                                    <li className="flex items-center gap-5 text-lg font-bold text-slate-700 active:text-red-500"><Icon name="settings" size={22} /> 系統設定</li>
                                </ul>
                            </div>
                        </div>
                    )}

                    {/* Share Modal */}
                    {showShareModal && activeShareData && (
                        <div className="fixed inset-0 z-[200] flex items-center justify-center p-6 bg-slate-900/90 backdrop-blur-md">
                            <div className="bg-white w-full max-w-[340px] rounded-[3rem] overflow-hidden animate-modal shadow-2xl relative">
                                <div className="bg-gradient-to-br from-[#1a1c4b] to-[#0f172a] p-8 text-white relative">
                                    <div className="absolute top-0 right-0 p-8 opacity-10"><Icon name="pulse" size={140} /></div>
                                    <p className="text-[10px] font-black italic text-orange-500 uppercase tracking-[0.4em] mb-2">Workout Result</p>
                                    <h3 className="text-2xl font-black italic uppercase mb-8">{activeShareData.type} 達標！</h3>
                                    
                                    <div className="flex items-baseline gap-2 mb-10">
                                        <span className="text-7xl font-black italic sport-nums tracking-tighter leading-none">{activeShareData.distance}</span>
                                        <span className="text-sm font-bold text-slate-400 uppercase italic">KM</span>
                                    </div>

                                    <div className="grid grid-cols-2 gap-8 border-t border-white/10 pt-8">
                                        <div><p className="text-[8px] font-bold text-slate-500 uppercase mb-1">Time</p><p className="text-xl font-black italic sport-nums">{Math.floor(activeShareData.duration / 60)}'00"</p></div>
                                        <div><p className="text-[8px] font-bold text-slate-500 uppercase mb-1">Calories</p><p className="text-xl font-black italic sport-nums">{activeShareData.kcal} kcal</p></div>
                                    </div>
                                </div>
                                <div className="p-8 text-center bg-white">
                                    <p className="text-xs font-bold text-slate-400 mb-6">分享成就至社群平台</p>
                                    <div className="grid grid-cols-2 gap-4">
                                        <button onClick={() => setShowShareModal(false)} className="bg-[#06c755] text-white py-4 rounded-2xl text-[11px] font-black italic uppercase shadow-lg shadow-green-500/20 active:scale-95">LINE</button>
                                        <button onClick={() => setShowShareModal(false)} className="bg-[#1877f2] text-white py-4 rounded-2xl text-[11px] font-black italic uppercase shadow-lg shadow-blue-500/20 active:scale-95">Facebook</button>
                                    </div>
                                    <button onClick={() => setShowShareModal(false)} className="mt-8 text-[10px] font-black italic text-slate-300 uppercase tracking-widest hover:text-slate-800">關閉視窗</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="protruding-btn-wrapper">
                        <button onClick={() => {setCurrentView('fun_sports'); setActiveTab('fun_sports');}} className={`protruding-btn ${activeTab === 'fun_sports' ? 'active' : ''}`}>
                            <Icon name="pulse" size={24} />
                            <div className="protruding-label font-black">趣動 GO</div>
                        </button>
                    </div>

                    <nav className="bg-white/95 backdrop-blur-xl border-t border-slate-100 px-7 py-5 flex justify-between items-center rounded-t-[3rem] shadow-[0_-15px_50px_rgba(0,0,0,0.04)] z-50">
                        <button onClick={() => {setCurrentView('home'); setActiveTab('home');}} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'home' ? 'text-orange-500 scale-110' : 'text-slate-300'}`}>
                            <Icon name="home" size={24} /><span className="text-[9px] font-black italic uppercase tracking-widest">首頁</span>
                        </button>
                        <button onClick={() => {setCurrentView('log'); setActiveTab('log');}} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'log' ? 'text-orange-500 scale-110' : 'text-slate-300'}`}>
                            <Icon name="task" size={24} /><span className="text-[9px] font-black italic uppercase tracking-widest">日誌</span>
                        </button>
                        <div className="w-16"></div> 
                        <button onClick={() => {setCurrentView('home'); setActiveTab('stores');}} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'stores' ? 'text-orange-500 scale-110' : 'text-slate-300'}`}>
                            <Icon name="store" size={24} /><span className="text-[9px] font-black italic uppercase tracking-widest">門店</span>
                        </button>
                        <button onClick={() => {setCurrentView('profile'); setActiveTab('profile');}} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'profile' ? 'text-orange-500 scale-110' : 'text-slate-300'}`}>
                            <Icon name="user" size={24} /><span className="text-[9px] font-black italic uppercase tracking-widest">我的</span>
                        </button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>